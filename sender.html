<!DOCTYPE html>
<html>
<head>
  <title>Sender</title>
</head>
<body>
  <h2>Sender (Camera Stream)</h2>
  <video id="senderVideo" autoplay muted playsinline></video>

  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <script>
    const peer = new Peer("sender", {
      config: {
        iceServers: [
          { urls: "stun:stun.l.google.com:19302" }
        ]
      },
      debug: 3
    });

    peer.on("open", id => {
      console.log("Sender peer open with ID:", id);
      startCameraAndCallViewer();
    });

    function startCameraAndCallViewer() {
      navigator.mediaDevices.getUserMedia({ video: true, audio: false })
        .then(stream => {
          document.getElementById("senderVideo").srcObject = stream;

          // Call viewer
          const call = peer.call("viewer", stream);
          console.log("Calling viewer...");

          call.on("error", err => {
            console.error("Call error:", err);
          });
        })
        .catch(error => {
          console.error("Camera access error:", error);
        });
    }

    peer.on("error", err => console.error("Peer error:", err));
  </script>
</body>
</html>
